const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContainerModal-BYcSEJyh.js","assets/index-BHFnowVW.js","assets/router-vendor-Cn7T_umG.js","assets/react-vendor-DlBnNAMw.js","assets/ui-vendor-CcwIbSm0.js","assets/index-VRrh9Lou.css","assets/StatusBadge-WE8vTTfy.js","assets/charts-vendor-BIeDjWhj.js","assets/utils-vendor-DnsfCnls.js"])))=>i.map(i=>d[i]);
import{j as e,a as m,_ as T}from"./index-BHFnowVW.js";import{r as d}from"./router-vendor-Cn7T_umG.js";import{P as U,g as O,h as q,i as H,d as I,j as w,R as g,t as h,A as B,k as G}from"./ui-vendor-CcwIbSm0.js";import{f as J}from"./utils-vendor-DnsfCnls.js";import"./react-vendor-DlBnNAMw.js";function D({container:s,onClick:y,hasUpdate:n=!1}){return e.jsxs("div",{onClick:y,className:"bg-tide-surface border border-tide-border rounded-lg p-4 hover:border-primary/50 transition-all cursor-pointer group",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-tide-text truncate group-hover:text-primary transition-colors",children:s.name}),e.jsxs("p",{className:"text-sm text-tide-text-muted truncate mt-1",children:[s.image,":",s.current_tag]})]})}),n&&e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-accent/20 text-accent border border-accent/30",children:"Update Available"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-tide-text",children:[e.jsx(U,{size:14,className:"text-tide-text-muted"}),e.jsx("span",{className:"truncate",children:s.image.split("/").pop()})]}),e.jsxs("div",{className:"flex items-center gap-2 text-tide-text",children:[e.jsx(O,{size:14,className:"text-tide-text-muted"}),e.jsx("span",{className:"truncate",children:s.updated_at?J(new Date(s.updated_at),"MMM d, yyyy"):"N/A"})]}),e.jsx("div",{className:"flex items-center gap-2 text-tide-text",children:s.policy==="auto"?e.jsxs(e.Fragment,{children:[e.jsx(q,{size:14,className:"text-primary"}),e.jsx("span",{children:"Auto-update"})]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{size:14,className:"text-tide-text-muted"}),e.jsx("span",{children:"Manual"})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-tide-text",children:[e.jsx("span",{className:"text-tide-text-muted",children:"Scope:"}),e.jsx("span",{className:"capitalize",children:s.scope||"patch"})]}),s.vulnforge_enabled&&e.jsx("div",{className:"col-span-2 flex items-center gap-2",children:s.current_vuln_count===0?e.jsxs(e.Fragment,{children:[e.jsx(I,{size:14,className:"text-green-400"}),e.jsx("span",{className:"text-green-400",children:"No known vulnerabilities"})]}):s.current_vuln_count<=5?e.jsxs(e.Fragment,{children:[e.jsx(w,{size:14,className:"text-yellow-400"}),e.jsxs("span",{className:"text-yellow-400",children:[s.current_vuln_count," vulnerabilities"]})]}):s.current_vuln_count<=10?e.jsxs(e.Fragment,{children:[e.jsx(w,{size:14,className:"text-orange-400"}),e.jsxs("span",{className:"text-orange-400",children:[s.current_vuln_count," vulnerabilities"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{size:14,className:"text-red-400"}),e.jsxs("span",{className:"text-red-400",children:[s.current_vuln_count," vulnerabilities"]})]})})]}),(s.restart_policy||s.auto_restart_enabled)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-tide-border flex items-center justify-between gap-3",children:[s.restart_policy&&e.jsxs("span",{className:"text-xs text-tide-text-muted",children:["Docker: ",e.jsx("span",{className:"text-tide-text",children:s.restart_policy})]}),s.auto_restart_enabled&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-teal-500/10 text-teal-400 border border-teal-500/30",children:[e.jsx(g,{size:10}),"Auto-Restart"]})]})]})}const K=d.lazy(()=>T(()=>import("./ContainerModal-BYcSEJyh.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])));function ee(){const[s,y]=d.useState([]),[n,S]=d.useState([]),[r,L]=d.useState(null),[P,k]=d.useState(!0),[j,A]=d.useState(!1),[f,z]=d.useState(!1),[F,_]=d.useState(null),[l,b]=d.useState({search:"",status:"all",autoUpdate:"all",hasUpdate:"all"}),[u]=d.useState({field:"name",direction:"asc"}),p=d.useCallback(async()=>{k(!0);try{const[t,i,a]=await Promise.all([m.containers.getAll(),m.updates.getAll(),m.analytics.getSummary(30)]);y(t),S(i),L(a)}catch{h.error("Failed to load data")}finally{k(!1)}},[]),M=d.useCallback(async()=>{A(!0);try{const t=await m.containers.sync();h.success(`Synced ${t.containers_found} containers: ${t.stats.added} added, ${t.stats.updated} updated`),await p()}catch{h.error("Failed to sync containers")}finally{A(!1)}},[p]),R=d.useCallback(async()=>{z(!0);try{const t=await m.updates.checkAll();h.success(`Checked ${t.stats.checked} containers, found ${t.stats.updates_found} updates`);const i=await m.updates.getAll();S(i)}catch{h.error("Failed to check for updates")}finally{z(!1)}},[]);d.useEffect(()=>{p()},[p]);const N=d.useMemo(()=>{const t=new Map(n.filter(a=>a.status==="pending").map(a=>[a.container_id,!0])),i=s.filter(a=>{if(l.search){const x=l.search.toLowerCase();if(!a.name.toLowerCase().includes(x)&&!a.image.toLowerCase().includes(x))return!1}const v=a.policy==="auto";if(l.autoUpdate==="enabled"&&!v||l.autoUpdate==="disabled"&&v)return!1;const o=t.has(a.id);return!(l.hasUpdate==="yes"&&!o||l.hasUpdate==="no"&&o)});return i.sort((a,v)=>{let o=a[u.field],x=v[u.field];return typeof o=="string"&&(o=o.toLowerCase()),typeof x=="string"&&(x=x.toLowerCase()),o<x?u.direction==="asc"?-1:1:o>x?u.direction==="asc"?1:-1:0}),i},[s,l,n,u]),{myProjects:C,otherContainers:E}=d.useMemo(()=>({myProjects:N.filter(t=>t.is_my_project),otherContainers:N.filter(t=>!t.is_my_project)}),[N]),c=d.useMemo(()=>({totalContainers:s.length,runningContainers:s.length,autoUpdateEnabled:s.filter(t=>t.policy==="auto").length,staleContainers:n.filter(t=>t.status==="pending"&&t.reason_type==="stale").length,pendingUpdates:n.filter(t=>t.status==="pending").length}),[s,n]),$=d.useMemo(()=>s.reduce((t,i)=>{const a=i.policy||"manual";return t[a]=(t[a]||0)+1,t},{}),[s]),V={auto:"bg-primary",manual:"bg-accent",security:"bg-yellow-500",disabled:"bg-tide-surface-light"};return e.jsxs("div",{className:"min-h-screen bg-tide-bg",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8",children:[e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Total Containers"}),e.jsx("p",{className:"text-3xl font-bold text-tide-text mt-2",children:c.totalContainers})]}),e.jsx(U,{className:"text-primary",size:32})]})}),e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Running"}),e.jsx("p",{className:"text-3xl font-bold text-green-400 mt-2",children:c.runningContainers})]}),e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse"})]})}),e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Auto-Update Enabled"}),e.jsx("p",{className:"text-3xl font-bold text-primary mt-2",children:c.autoUpdateEnabled})]}),e.jsx(g,{className:"text-primary",size:32})]})}),e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Stale Containers"}),e.jsx("p",{className:"text-3xl font-bold text-orange-400 mt-2",children:c.staleContainers})]}),e.jsx(B,{className:"text-orange-400",size:32})]})}),e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Pending Updates"}),e.jsx("p",{className:"text-3xl font-bold text-accent mt-2",children:c.pendingUpdates})]}),c.pendingUpdates>0&&e.jsx("div",{className:"w-3 h-3 bg-accent rounded-full animate-pulse"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-tide-text",children:"Update Frequency"}),e.jsx("span",{className:"text-xs text-tide-text-muted",children:"Last 30 days"})]}),!r||r.total_updates===0?e.jsx("div",{className:"text-sm text-tide-text-muted",children:"No analytics available yet. Run a few updates to populate trends."}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("span",{className:"text-3xl font-bold text-primary",children:r.total_updates}),e.jsx("span",{className:"text-xs text-tide-text-muted",children:"total updates"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-tide-text-muted",children:"Successful"}),e.jsx("div",{className:"text-lg font-semibold text-green-400",children:r.successful_updates})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-tide-text-muted",children:"Failed"}),e.jsx("div",{className:"text-lg font-semibold text-red-400",children:r.failed_updates})]})]}),r.avg_update_duration_seconds>0&&e.jsxs("div",{className:"text-xs text-tide-text-muted pt-2 border-t border-tide-border",children:["Avg duration: ",Math.round(r.avg_update_duration_seconds),"s"]})]})]}),e.jsxs("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-tide-text",children:"CVEs Resolved"}),e.jsx("span",{className:"text-xs text-tide-text-muted",children:"Last 30 days"})]}),!r||r.total_cves_fixed===0?e.jsx("div",{className:"text-sm text-tide-text-muted",children:"No CVEs resolved yet. Updates with security fixes will appear here."}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("span",{className:"text-3xl font-bold text-green-400",children:r.total_cves_fixed}),e.jsx("span",{className:"text-xs text-tide-text-muted",children:"CVEs fixed"})]}),e.jsx("div",{className:"text-xs text-tide-text-muted",children:r.successful_updates>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Avg per update:"}),e.jsx("span",{className:"font-semibold text-tide-text",children:(r.total_cves_fixed/r.successful_updates).toFixed(1)})]})})]})]}),e.jsxs("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-tide-text",children:"Policy Distribution"}),e.jsx("span",{className:"text-xs text-tide-text-muted",children:"Current"})]}),c.totalContainers===0?e.jsx("div",{className:"text-sm text-tide-text-muted",children:"No containers found"}):e.jsx("div",{className:"space-y-2",children:Object.entries($).map(([t,i])=>{const a=Math.round(i/c.totalContainers*100);return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-tide-text-muted",children:[e.jsx("span",{className:"capitalize",children:t}),e.jsxs("span",{children:[i," (",a,"%)"]})]}),e.jsx("div",{className:"h-2 bg-tide-surface rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${V[t]||"bg-tide-border-light"}`,style:{width:`${a}%`}})})]},t)})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-tide-text-muted",size:20}),e.jsx("input",{type:"text",placeholder:"Search containers...",value:l.search,onChange:t=>b({...l,search:t.target.value}),className:"w-full pl-10 pr-4 py-2 bg-tide-surface border border-tide-border rounded-lg text-tide-text placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:l.status,onChange:t=>b({...l,status:t.target.value}),className:"px-4 py-2 bg-tide-surface border border-tide-border rounded-lg text-tide-text focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"running",children:"Running"}),e.jsx("option",{value:"stopped",children:"Stopped"}),e.jsx("option",{value:"exited",children:"Exited"})]}),e.jsxs("select",{value:l.autoUpdate,onChange:t=>b({...l,autoUpdate:t.target.value}),className:"px-4 py-2 bg-tide-surface border border-tide-border rounded-lg text-tide-text focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"All Auto-Update"}),e.jsx("option",{value:"enabled",children:"Enabled"}),e.jsx("option",{value:"disabled",children:"Disabled"})]}),e.jsxs("select",{value:l.hasUpdate,onChange:t=>b({...l,hasUpdate:t.target.value}),className:"px-4 py-2 bg-tide-surface border border-tide-border rounded-lg text-tide-text focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"All Updates"}),e.jsx("option",{value:"yes",children:"Has Updates"}),e.jsx("option",{value:"no",children:"No Updates"})]}),e.jsxs("button",{onClick:M,disabled:j||f,className:"px-4 py-2 bg-primary hover:bg-primary-dark text-tide-text rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2",children:[e.jsx(g,{size:16,className:j?"animate-spin":""}),j?"Scanning...":"Scan"]}),e.jsxs("button",{onClick:R,disabled:j||f,className:"px-4 py-2 bg-accent hover:bg-accent-dark text-tide-text rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2",children:[e.jsx(g,{size:16,className:f?"animate-spin":""}),f?"Checking...":"Check Updates"]})]})]}),P?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(g,{className:"animate-spin mx-auto mb-4 text-primary",size:48}),e.jsx("p",{className:"text-tide-text-muted",children:"Loading containers..."})]}):N.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"mx-auto mb-4 text-gray-600",size:48}),e.jsx("p",{className:"text-tide-text-muted",children:"No containers found"}),e.jsx("button",{onClick:M,className:"mt-4 px-4 py-2 bg-primary hover:bg-primary-dark text-tide-text rounded-lg font-medium transition-colors",children:"Scan for Containers"})]}):e.jsxs(e.Fragment,{children:[C.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-tide-text mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-primary",children:"â˜…"})," My Projects"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map(t=>{const i=n.some(a=>a.container_id===t.id&&a.status==="pending");return e.jsx(D,{container:t,hasUpdate:i,onClick:()=>_(t)},t.id)})})]}),E.length>0&&e.jsxs("div",{children:[C.length>0&&e.jsx("h2",{className:"text-xl font-bold text-tide-text mb-4",children:"Community Containers"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map(t=>{const i=n.some(a=>a.container_id===t.id&&a.status==="pending");return e.jsx(D,{container:t,hasUpdate:i,onClick:()=>_(t)},t.id)})})]})]})]}),F&&e.jsx(d.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-cyan-400 border-t-transparent rounded-full"})}),children:e.jsx(K,{container:F,onClose:()=>_(null),onUpdate:p})})]})}export{ee as default};
