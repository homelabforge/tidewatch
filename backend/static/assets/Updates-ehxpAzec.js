import{j as e,a as l}from"./index-CGBKEoxX.js";import{r as h}from"./router-vendor-B592UMyg.js";import{S as B}from"./StatusBadge-Cc0T94DK.js";import{i as D,f as y,E as I,j as K,k as A,l as F,X as V,A as j,m as X,t as r,R as U,n as R,o as S,p as q,q as G}from"./ui-vendor-C8hJcGlO.js";import{f as $}from"./utils-vendor-DnsfCnls.js";import"./react-vendor-OvXVS5lI.js";function H({update:t,onApprove:p,onReject:n,onApply:o,onSnooze:i,onRemoveContainer:d,onCancelRetry:c,onDelete:u}){const a=t.reason_type==="stale",f=x=>{if(!x)return"text-tide-text-muted";const g=x.toLowerCase();return g.includes("highly")?"text-green-400":g.includes("optional")?"text-blue-400":g.includes("review")?"text-yellow-400":"text-tide-text-muted"},b=x=>x==="security"?e.jsx(y,{size:16,className:"text-red-400"}):x==="stale"?e.jsx(j,{size:16,className:"text-orange-400"}):e.jsx(X,{size:16,className:"text-yellow-400"});return e.jsxs("div",{className:`bg-tide-surface border ${a?"border-orange-600":"border-tide-border"} rounded-lg p-5`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-tide-text mb-1",children:t.container_name}),a?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-orange-400",children:[e.jsx("span",{className:"font-mono",children:t.from_tag}),e.jsx("span",{children:"• Inactive Container"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-sm text-tide-text-muted",children:[e.jsx("span",{className:"font-mono",children:t.from_tag}),e.jsx(D,{size:14}),e.jsx("span",{className:"font-mono text-primary",children:t.to_tag})]})]}),e.jsx(B,{status:t.status})]}),e.jsxs("div",{className:"flex items-start gap-2 mb-3",children:[b(t.reason_type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-tide-text capitalize",children:[t.reason_type," Update"]}),t.reason_summary&&e.jsx("p",{className:"text-sm text-tide-text-muted mt-1",children:t.reason_summary})]})]}),t.recommendation&&e.jsx("div",{className:"mb-3",children:e.jsx("span",{className:`text-sm font-medium ${f(t.recommendation)}`,children:t.recommendation})}),(t.cves_fixed.length>0||t.vuln_delta!==0)&&e.jsxs("div",{className:"bg-tide-surface/50 rounded-md p-3 mb-3 space-y-2",children:[t.cves_fixed.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(y,{size:14,className:"text-green-400"}),e.jsxs("span",{className:"text-tide-text",children:["Fixes ",t.cves_fixed.length," CVE",t.cves_fixed.length>1?"s":""]})]}),t.vuln_delta!==0&&e.jsx("div",{className:"flex items-center gap-2 text-sm",children:e.jsxs("span",{className:t.vuln_delta<0?"text-green-400":"text-red-400",children:[t.vuln_delta<0?"↓":"↑"," ",Math.abs(t.vuln_delta)," vulnerabilities"]})})]}),t.changelog_url&&e.jsxs("a",{href:t.changelog_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-sm text-primary hover:text-primary-dark mb-3",children:["View Changelog ",e.jsx(I,{size:12})]}),e.jsxs("div",{className:"text-xs text-tide-text-muted mb-4 space-y-1",children:[t.published_date&&e.jsxs("div",{children:["Published: ",$(new Date(t.published_date),"MMM d, yyyy")]}),t.image_size_delta!==0&&e.jsxs("div",{children:["Size: ",t.image_size_delta>0?"+":"",(t.image_size_delta/1024/1024).toFixed(1)," MB"]})]}),t.status==="pending"&&a&&(i||d||n)&&e.jsxs("div",{className:"flex gap-2",children:[i&&e.jsxs("button",{onClick:()=>i(t.id),className:"flex-1 px-3 py-2 bg-gray-700 hover:bg-tide-surface-light text-tide-text rounded-md text-sm font-medium flex items-center justify-center gap-2 transition-colors",title:"Dismiss for 30 days",children:[e.jsx(K,{size:14}),"Snooze"]}),d&&e.jsxs("button",{onClick:()=>d(t.id),className:"flex-1 px-3 py-2 bg-red-600/80 hover:bg-red-600 text-tide-text rounded-md text-sm font-medium flex items-center justify-center gap-2 transition-colors",title:"Remove container from database",children:[e.jsx(A,{size:14}),"Remove"]}),n&&e.jsxs("button",{onClick:()=>n(t.id),className:"flex-1 px-3 py-2 bg-gray-700 hover:bg-tide-surface-light text-tide-text rounded-md text-sm font-medium flex items-center justify-center gap-2 transition-colors",title:"Keep container in database",children:[e.jsx(F,{size:14}),"Keep"]})]}),t.status==="pending"&&!a&&(p||n)&&e.jsxs("div",{className:"flex gap-2",children:[p&&e.jsxs("button",{onClick:()=>p(t.id),className:"flex-1 px-3 py-2 bg-primary hover:bg-primary-dark text-tide-text rounded-md text-sm font-medium flex items-center justify-center gap-2 transition-colors",children:[e.jsx(F,{size:14}),"Approve"]}),n&&e.jsxs("button",{onClick:()=>n(t.id),className:"flex-1 px-3 py-2 bg-gray-700 hover:bg-tide-surface-light text-tide-text rounded-md text-sm font-medium flex items-center justify-center gap-2 transition-colors",children:[e.jsx(V,{size:14}),"Reject"]})]}),t.status==="approved"&&o&&e.jsx("button",{onClick:()=>o(t.id),className:"w-full px-3 py-2 bg-accent hover:bg-accent-dark text-tide-text rounded-md text-sm font-medium transition-colors",children:"Apply Update"}),t.status==="pending_retry"&&(c||n||u)&&e.jsxs("div",{className:"flex gap-2",children:[c&&e.jsx("button",{onClick:()=>c(t.id),className:"flex-1 px-3 py-2 bg-blue-500/20 hover:bg-blue-500/30 border border-blue-500/50 text-blue-400 rounded-md text-sm font-medium transition-colors",children:"Cancel Retry"}),n&&e.jsx("button",{onClick:()=>n(t.id),className:"flex-1 px-3 py-2 bg-yellow-500/20 hover:bg-yellow-500/30 border border-yellow-500/50 text-yellow-400 rounded-md text-sm font-medium transition-colors",children:"Reject"}),u&&e.jsx("button",{onClick:()=>u(t.id),className:"px-3 py-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/50 text-red-400 rounded-md text-sm font-medium transition-colors",children:e.jsx(A,{className:"h-4 w-4"})})]}),t.last_error&&e.jsxs("div",{className:"mt-3 p-3 bg-red-500/10 border border-red-500/30 rounded-md",children:[e.jsx("p",{className:"text-xs text-red-400",children:t.last_error}),t.retry_count>0&&e.jsxs("p",{className:"text-xs text-tide-text-muted mt-1",children:["Retry ",t.retry_count,"/",t.max_retries,t.next_retry_at&&` • Next retry: ${$(new Date(t.next_retry_at),"PPp")}`]})]})]})}function te(){const[t,p]=h.useState([]),[n,o]=h.useState(!0),[i,d]=h.useState("all"),[c,u]=h.useState("all");h.useEffect(()=>{a()},[c]);const a=async()=>{o(!0);try{const s=c==="security"?await l.updates.getSecurity():await l.updates.getAll();p(s)}catch{r.error("Failed to load updates")}finally{o(!1)}},f=async s=>{try{await l.updates.approve(s),r.success("Update approved"),a()}catch{r.error("Failed to approve update")}},b=async s=>{const m=prompt("Reason for rejection (optional):");try{await l.updates.reject(s,m||void 0),r.success("Update rejected"),a()}catch{r.error("Failed to reject update")}},x=async s=>{if(confirm("Are you sure you want to apply this update?"))try{await l.updates.apply(s),r.success("Update applied successfully"),a()}catch{r.error("Failed to apply update")}},g=async s=>{try{const m=await l.updates.snooze(s);r.success(m.message),a()}catch{r.error("Failed to snooze notification")}},E=async s=>{if(confirm("Are you sure you want to permanently remove this container from the database? This action cannot be undone."))try{const m=await l.updates.removeContainer(s);r.success(m.message),a()}catch{r.error("Failed to remove container")}},T=async s=>{try{await l.updates.cancelRetry(s),r.success("Retry cancelled, update reset to pending"),a()}catch{r.error("Failed to cancel retry")}},L=async s=>{if(confirm("Are you sure you want to delete this update? This action cannot be undone."))try{const m=await l.updates.delete(s);r.success(m.message),a()}catch{r.error("Failed to delete update")}},v=async()=>{o(!0);try{const s=await l.updates.checkAll();r.success(`Checked ${s.stats.checked} containers, found ${s.stats.updates_found} updates`),a()}catch{r.error("Failed to check for updates"),o(!1)}},N=i==="all"?t.filter(s=>s.status!=="applied"):i==="stale"?t.filter(s=>s.status==="pending"&&s.reason_type==="stale"):i==="pending_retry"?t.filter(s=>s.status==="pending_retry"):t.filter(s=>s.status.toLowerCase()===i),w=t.filter(s=>s.status==="pending").length,_=t.filter(s=>s.status==="approved").length,C=t.filter(s=>s.status==="rejected").length,M=t.filter(s=>s.status==="pending_retry").length,k=t.filter(s=>s.status==="pending"&&s.reason_type==="stale").length,z=t.filter(s=>s.status==="applied").length,P=t.filter(s=>s.cves_fixed&&s.cves_fixed.length>0).length;return e.jsx("div",{className:"min-h-screen bg-tide-bg",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-tide-text",children:"Updates"}),e.jsx("p",{className:"text-tide-text-muted mt-2",children:"Review and manage container updates"})]}),e.jsxs("button",{onClick:v,disabled:n,className:"px-4 py-2 bg-primary hover:bg-primary-dark text-tide-text rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2",children:[e.jsx(U,{size:16,className:n?"animate-spin":""}),"Check All"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8",children:[e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Pending"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-400 mt-2",children:w})]}),e.jsx(R,{className:"text-yellow-400",size:32})]})}),e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Approved"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400 mt-2",children:_})]}),e.jsx(S,{className:"text-blue-400",size:32})]})}),e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Rejected"}),e.jsx("p",{className:"text-3xl font-bold text-tide-text-muted mt-2",children:C})]}),e.jsx(q,{className:"text-tide-text-muted",size:32})]})}),e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Stale"}),e.jsx("p",{className:"text-3xl font-bold text-orange-400 mt-2",children:k})]}),e.jsx(j,{className:"text-orange-400",size:32})]})}),e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Applied"}),e.jsx("p",{className:"text-3xl font-bold text-green-400 mt-2",children:z})]}),e.jsx(S,{className:"text-green-400",size:32})]})})]}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsx("button",{onClick:()=>u("all"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${c==="all"?"bg-primary text-tide-text":"bg-tide-surface text-tide-text-muted hover:bg-tide-surface"}`,children:"All Updates"}),e.jsxs("button",{onClick:()=>u("security"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap flex items-center gap-2 ${c==="security"?"bg-red-600 text-tide-text":"bg-tide-surface text-tide-text-muted hover:bg-tide-surface"}`,children:[e.jsx(y,{size:16}),"Security (",P,")"]})]}),e.jsxs("div",{className:"flex gap-2 mb-6 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>d("all"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${i==="all"?"bg-primary text-tide-text":"bg-tide-surface text-tide-text-muted hover:bg-tide-surface"}`,children:["All (",t.length,")"]}),e.jsxs("button",{onClick:()=>d("pending"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${i==="pending"?"bg-primary text-tide-text":"bg-tide-surface text-tide-text-muted hover:bg-tide-surface"}`,children:["Pending (",w,")"]}),e.jsxs("button",{onClick:()=>d("approved"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${i==="approved"?"bg-primary text-tide-text":"bg-tide-surface text-tide-text-muted hover:bg-tide-surface"}`,children:["Approved (",_,")"]}),e.jsxs("button",{onClick:()=>d("pending_retry"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap flex items-center gap-1.5 ${i==="pending_retry"?"bg-blue-600 text-tide-text":"bg-tide-surface text-tide-text-muted hover:bg-tide-surface"}`,children:[e.jsx(G,{size:14}),"Retrying (",M,")"]}),e.jsxs("button",{onClick:()=>d("rejected"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${i==="rejected"?"bg-primary text-tide-text":"bg-tide-surface text-tide-text-muted hover:bg-tide-surface"}`,children:["Rejected (",C,")"]}),e.jsxs("button",{onClick:()=>d("stale"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap flex items-center gap-1.5 ${i==="stale"?"bg-orange-600 text-tide-text":"bg-tide-surface text-tide-text-muted hover:bg-tide-surface"}`,children:[e.jsx(j,{size:14}),"Stale (",k,")"]}),e.jsxs("button",{onClick:()=>d("applied"),className:`px-4 py-2 rounded-lg font-medium transition-colors whitespace-nowrap ${i==="applied"?"bg-primary text-tide-text":"bg-tide-surface text-tide-text-muted hover:bg-tide-surface"}`,children:["Applied (",z,")"]})]}),n?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"animate-spin mx-auto mb-4 text-primary",size:48}),e.jsx("p",{className:"text-tide-text-muted",children:"Loading updates..."})]}):N.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(R,{className:"mx-auto mb-4 text-gray-600",size:48}),e.jsx("p",{className:"text-tide-text-muted",children:"No updates found"}),e.jsx("button",{onClick:v,className:"mt-4 px-4 py-2 bg-primary hover:bg-primary-dark text-tide-text rounded-lg font-medium transition-colors",children:"Check for Updates"})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:N.map(s=>e.jsx(H,{update:s,onApprove:f,onReject:b,onApply:x,onSnooze:g,onRemoveContainer:E,onCancelRetry:T,onDelete:L},s.id))})]})})}export{te as default};
