const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ContainerModal-DZzR_jP7.js","assets/index-Co59pYVW.js","assets/router-vendor-h5EZ-JED.js","assets/react-vendor-C6WxKkic.js","assets/ui-vendor-TZ6_hWVS.js","assets/index-BA9_ip66.css","assets/StatusBadge-Dt8L00S1.js","assets/utils-vendor-DnsfCnls.js","assets/charts-vendor-dUpW-fSj.js"])))=>i.map(i=>d[i]);
import{j as e,a as h,u as ee,_ as te}from"./index-Co59pYVW.js";import{r as a}from"./router-vendor-h5EZ-JED.js";import{P,g as se,h as V,i as ae,j as re,d as B,B as le,k as ne,l as M,m as de,t as g,R as U,A as ie,n as ce}from"./ui-vendor-TZ6_hWVS.js";import{f as oe}from"./utils-vendor-DnsfCnls.js";import{C as xe}from"./CheckProgressBar-CuCaV4t2.js";import"./react-vendor-C6WxKkic.js";function ue(s,v){const i=s.match(/^v?(\d+)\.(\d+)\.(\d+)/),f=v.match(/^v?(\d+)\.(\d+)\.(\d+)/);if(i&&f){const[,n,x]=i,[,b,C]=f;return n!==b?"major":x!==C?"minor":"patch"}return"minor"}function I({container:s,onClick:v,hasUpdate:i=!1,vulnforgeGlobalEnabled:f=!1}){let n="",x="",b=null;return i&&s.latest_tag?(b=ue(s.current_tag,s.latest_tag),x=`Update Available → ${s.latest_tag}`,b==="patch"?n="bg-gray-500/20 text-gray-400 border-gray-500/30":b==="minor"?n="bg-blue-500/20 text-blue-400 border-blue-500/30":n="bg-orange-500/20 text-orange-400 border-orange-500/30"):s.latest_major_tag&&s.scope!=="major"&&(x=`Major Update (Blocked by ${s.scope})`,n="bg-orange-500/20 text-orange-400 border-orange-500/30"),e.jsxs("div",{onClick:v,className:"bg-tide-surface border border-tide-border rounded-lg p-4 hover:border-primary/50 transition-all cursor-pointer group",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-tide-text truncate group-hover:text-primary transition-colors",children:s.name}),e.jsxs("p",{className:"text-sm text-tide-text-muted truncate mt-1",children:[s.image,":",s.current_tag]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-tide-text",children:[e.jsx(P,{size:14,className:"text-tide-text-muted"}),e.jsx("span",{className:"truncate",children:s.image.split("/").pop()})]}),e.jsxs("div",{className:"flex items-center gap-2 text-tide-text",children:[e.jsx(se,{size:14,className:"text-tide-text-muted"}),e.jsx("span",{className:"truncate",children:s.updated_at?oe(new Date(s.updated_at),"MMM d, yyyy"):"N/A"})]}),e.jsx("div",{className:"flex items-center gap-2 text-tide-text",children:s.policy==="auto"?e.jsxs(e.Fragment,{children:[e.jsx(V,{size:14,className:"text-orange-400"}),e.jsx("span",{className:"text-orange-400",children:"Auto (All)"})]}):s.policy==="patch-only"?e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:14,className:"text-green-400"}),e.jsx("span",{children:"Patch Only"})]}):s.policy==="minor-and-patch"?e.jsxs(e.Fragment,{children:[e.jsx(re,{size:14,className:"text-primary"}),e.jsx("span",{children:"Minor + Patch"})]}):s.policy==="security"?e.jsxs(e.Fragment,{children:[e.jsx(B,{size:14,className:"text-yellow-400"}),e.jsx("span",{children:"Security"})]}):s.policy==="disabled"?e.jsxs(e.Fragment,{children:[e.jsx(le,{size:14,className:"text-red-400"}),e.jsx("span",{className:"text-red-400",children:"Disabled"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:14,className:"text-tide-text-muted"}),e.jsx("span",{children:"Manual"})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-tide-text",children:[e.jsx("span",{className:"text-tide-text-muted",children:"Scope:"}),e.jsx("span",{className:"capitalize",children:s.scope||"patch"})]}),f&&s.vulnforge_enabled&&e.jsx("div",{className:"col-span-2 flex items-center gap-2",children:s.current_vuln_count===0?e.jsxs(e.Fragment,{children:[e.jsx(B,{size:14,className:"text-green-400"}),e.jsx("span",{className:"text-green-400",children:"No known vulnerabilities"})]}):s.current_vuln_count<=5?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:14,className:"text-yellow-400"}),e.jsxs("span",{className:"text-yellow-400",children:[s.current_vuln_count," vulnerabilities"]})]}):s.current_vuln_count<=10?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:14,className:"text-orange-400"}),e.jsxs("span",{className:"text-orange-400",children:[s.current_vuln_count," vulnerabilities"]})]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{size:14,className:"text-red-400"}),e.jsxs("span",{className:"text-red-400",children:[s.current_vuln_count," vulnerabilities"]})]})})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t border-tide-border/50",children:[e.jsx("div",{className:"flex flex-wrap gap-2 min-h-[24px]",children:s.auto_restart_enabled&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-500/20 text-blue-400 border border-blue-500/30",children:[e.jsx(de,{size:10,className:"mr-1"}),"Auto-Restart"]})}),e.jsx("div",{className:"flex flex-wrap gap-2 min-h-[24px]",children:x&&e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${n}`,children:[!i&&e.jsx(V,{size:12,className:"mr-1"}),x]})})]})]})}const me=a.lazy(()=>te(()=>import("./ContainerModal-DZzR_jP7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])));function Ne(){const[s,v]=a.useState([]),[i,f]=a.useState([]),[n,x]=a.useState(null),[b,C]=a.useState(!0),[_,E]=a.useState(!1),[q,S]=a.useState(!1),[J,z]=a.useState(null),[F,O]=a.useState(!1),[d,k]=a.useState({search:"",status:"all",autoUpdate:"all",hasUpdate:"all"}),[y]=a.useState({field:"name",direction:"asc"}),[c,j]=a.useState(null),o=a.useCallback(async()=>{C(!0);try{const[t,l,r,N]=await Promise.all([h.containers.getAll(),h.updates.getAll(),h.analytics.getSummary(30),h.settings.getAll()]);v(t),f(l),x(r);const m=N.find(p=>p.key==="vulnforge_enabled");O(m?.value==="true")}catch{g.error("Failed to load data")}finally{C(!1)}},[]),D=a.useCallback(async()=>{E(!0);try{const t=await h.containers.sync();g.success(`Synced ${t.containers_found} containers: ${t.stats.added} added, ${t.stats.updated} updated`),await o()}catch{g.error("Failed to sync containers")}finally{E(!1)}},[o]),G=a.useCallback(async()=>{S(!0);try{const t=await h.updates.checkAll();if(t.already_running){g.info("Update check already in progress");const l=await h.updates.getCheckJob(t.job_id);j({jobId:l.id,status:l.status,totalCount:l.total_count,checkedCount:l.checked_count,updatesFound:l.updates_found,errorsCount:l.errors_count,currentContainer:l.current_container,progressPercent:l.progress_percent})}else j({jobId:t.job_id,status:"queued",totalCount:0,checkedCount:0,updatesFound:0,errorsCount:0,currentContainer:null,progressPercent:0}),g.info("Update check started");S(!1)}catch{g.error("Failed to start update check"),S(!1)}},[]),L=a.useCallback(t=>{j({jobId:t.job_id,status:t.status,totalCount:t.total_count,checkedCount:t.checked_count,updatesFound:t.updates_found,errorsCount:t.errors_count||0,currentContainer:t.current_container||null,progressPercent:t.progress_percent||0})},[]),H=a.useCallback(t=>{j({jobId:t.job_id,status:"done",totalCount:t.total_count,checkedCount:t.checked_count,updatesFound:t.updates_found,errorsCount:t.errors_count||0,currentContainer:null,progressPercent:100}),o()},[o]),K=a.useCallback(()=>{j(t=>t?{...t,status:"failed"}:null)},[]),Q=a.useCallback(()=>{j(t=>t?{...t,status:"canceled"}:null),o()},[o]),W=a.useCallback(async()=>{if(c)try{await h.updates.cancelCheckJob(c.jobId),g.info("Cancellation requested")}catch{g.error("Failed to cancel check")}},[c]),X=a.useCallback(()=>{j(null)},[]);ee({onCheckJobStarted:L,onCheckJobProgress:L,onCheckJobCompleted:H,onCheckJobFailed:K,onCheckJobCanceled:Q,enableToasts:!1}),a.useEffect(()=>{o()},[o]);const w=a.useMemo(()=>{const t=new Map(i.filter(r=>r.status==="pending").map(r=>[r.container_id,!0])),l=s.filter(r=>{if(d.search){const p=d.search.toLowerCase();if(!r.name.toLowerCase().includes(p)&&!r.image.toLowerCase().includes(p))return!1}const N=r.policy==="auto";if(d.autoUpdate==="enabled"&&!N||d.autoUpdate==="disabled"&&N)return!1;const m=t.has(r.id);return!(d.hasUpdate==="yes"&&!m||d.hasUpdate==="no"&&m)});return l.sort((r,N)=>{const m=r[y.field],p=N[y.field],T=typeof m=="string"?m.toLowerCase():String(m||""),$=typeof p=="string"?p.toLowerCase():String(p||"");return T<$?y.direction==="asc"?-1:1:T>$?y.direction==="asc"?1:-1:0}),l},[s,d,i,y]),{myProjects:A,otherContainers:R}=a.useMemo(()=>({myProjects:w.filter(t=>t.is_my_project),otherContainers:w.filter(t=>!t.is_my_project)}),[w]),u=a.useMemo(()=>({totalContainers:s.length,runningContainers:s.length,autoUpdateEnabled:s.filter(t=>t.policy==="auto").length,staleContainers:i.filter(t=>t.status==="pending"&&t.reason_type==="stale").length,pendingUpdates:i.filter(t=>t.status==="pending").length}),[s,i]),Y=a.useMemo(()=>s.reduce((t,l)=>{const r=l.policy||"manual";return t[r]=(t[r]||0)+1,t},{}),[s]),Z={auto:"bg-primary",manual:"bg-accent",security:"bg-yellow-500",disabled:"bg-tide-surface-light"};return e.jsxs("div",{className:"min-h-screen bg-tide-bg",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8",children:[e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Total Containers"}),e.jsx("p",{className:"text-3xl font-bold text-tide-text mt-2",children:u.totalContainers})]}),e.jsx(P,{className:"text-primary",size:32})]})}),e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Running"}),e.jsx("p",{className:"text-3xl font-bold text-green-400 mt-2",children:u.runningContainers})]}),e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse"})]})}),e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Auto-Update Enabled"}),e.jsx("p",{className:"text-3xl font-bold text-primary mt-2",children:u.autoUpdateEnabled})]}),e.jsx(U,{className:"text-primary",size:32})]})}),e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Stale Containers"}),e.jsx("p",{className:"text-3xl font-bold text-orange-400 mt-2",children:u.staleContainers})]}),e.jsx(ie,{className:"text-orange-400",size:32})]})}),e.jsx("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-tide-text-muted",children:"Pending Updates"}),e.jsx("p",{className:"text-3xl font-bold text-accent mt-2",children:u.pendingUpdates})]}),u.pendingUpdates>0&&e.jsx("div",{className:"w-3 h-3 bg-accent rounded-full animate-pulse"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-tide-text",children:"Update Frequency"}),e.jsx("span",{className:"text-xs text-tide-text-muted",children:"Last 30 days"})]}),!n||n.total_updates===0?e.jsx("div",{className:"text-sm text-tide-text-muted",children:"No analytics available yet. Run a few updates to populate trends."}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-tide-text-muted",children:"Total Updates"}),e.jsx("div",{className:"text-3xl font-bold text-primary",children:n.total_updates})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-tide-text-muted",children:"Successful"}),e.jsx("div",{className:"text-lg font-semibold text-green-400",children:n.successful_updates})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-tide-text-muted",children:"Failed"}),e.jsx("div",{className:"text-lg font-semibold text-red-400",children:n.failed_updates})]})]}),n.avg_update_duration_seconds>0&&e.jsxs("div",{className:"text-xs text-tide-text-muted pt-2 border-t border-tide-border",children:["Avg duration: ",Math.round(n.avg_update_duration_seconds),"s"]})]})]}),F&&e.jsxs("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-tide-text",children:"CVEs Resolved"}),e.jsx("span",{className:"text-xs text-tide-text-muted",children:"Last 30 days"})]}),!n||n.total_cves_fixed===0?e.jsx("div",{className:"text-sm text-tide-text-muted",children:"No CVEs resolved yet. Updates with security fixes will appear here."}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("span",{className:"text-3xl font-bold text-green-400",children:n.total_cves_fixed}),e.jsx("span",{className:"text-xs text-tide-text-muted",children:"CVEs fixed"})]}),e.jsx("div",{className:"text-xs text-tide-text-muted",children:n.successful_updates>0&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Avg per update:"}),e.jsx("span",{className:"font-semibold text-tide-text",children:(n.total_cves_fixed/n.successful_updates).toFixed(1)})]})})]})]}),e.jsxs("div",{className:"bg-tide-surface rounded-lg p-6 border border-tide-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-tide-text",children:"Policy Distribution"}),e.jsx("span",{className:"text-xs text-tide-text-muted",children:"Current"})]}),u.totalContainers===0?e.jsx("div",{className:"text-sm text-tide-text-muted",children:"No containers found"}):e.jsx("div",{className:"space-y-2",children:Object.entries(Y).map(([t,l])=>{const r=Math.round(l/u.totalContainers*100);return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-tide-text-muted",children:[e.jsx("span",{className:"capitalize",children:t}),e.jsxs("span",{children:[l," (",r,"%)"]})]}),e.jsx("div",{className:"h-2 bg-tide-surface rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${Z[t]||"bg-tide-border-light"}`,style:{width:`${r}%`}})})]},t)})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-tide-text-muted",size:20}),e.jsx("input",{type:"text",placeholder:"Search containers...",value:d.search,onChange:t=>k({...d,search:t.target.value}),className:"w-full pl-10 pr-4 py-2 bg-tide-surface border border-tide-border rounded-lg text-tide-text placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:d.status,onChange:t=>k({...d,status:t.target.value}),className:"px-4 py-2 bg-tide-surface border border-tide-border rounded-lg text-tide-text focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"running",children:"Running"}),e.jsx("option",{value:"stopped",children:"Stopped"}),e.jsx("option",{value:"exited",children:"Exited"})]}),e.jsxs("select",{value:d.autoUpdate,onChange:t=>k({...d,autoUpdate:t.target.value}),className:"px-4 py-2 bg-tide-surface border border-tide-border rounded-lg text-tide-text focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"All Auto-Update"}),e.jsx("option",{value:"enabled",children:"Enabled"}),e.jsx("option",{value:"disabled",children:"Disabled"})]}),e.jsxs("select",{value:d.hasUpdate,onChange:t=>k({...d,hasUpdate:t.target.value}),className:"px-4 py-2 bg-tide-surface border border-tide-border rounded-lg text-tide-text focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"All Updates"}),e.jsx("option",{value:"yes",children:"Has Updates"}),e.jsx("option",{value:"no",children:"No Updates"})]}),e.jsxs("button",{onClick:D,disabled:_||q,className:"px-4 py-2 bg-primary hover:bg-primary-dark text-tide-text rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2",children:[e.jsx(U,{size:16,className:_?"animate-spin":""}),_?"Scanning...":"Scan"]}),e.jsxs("button",{onClick:G,disabled:_||c?.status==="running"||c?.status==="queued",className:"px-4 py-2 bg-accent hover:bg-accent-dark text-tide-text rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2",children:[e.jsx(U,{size:16,className:c?.status==="running"||c?.status==="queued"?"animate-spin":""}),"Check Updates"]})]})]}),c&&e.jsx(xe,{job:c,onCancel:W,onDismiss:X}),b?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"animate-spin mx-auto mb-4 text-primary",size:48}),e.jsx("p",{className:"text-tide-text-muted",children:"Loading containers..."})]}):w.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"mx-auto mb-4 text-gray-600",size:48}),e.jsx("p",{className:"text-tide-text-muted",children:"No containers found"}),e.jsx("button",{onClick:D,className:"mt-4 px-4 py-2 bg-primary hover:bg-primary-dark text-tide-text rounded-lg font-medium transition-colors",children:"Scan for Containers"})]}):e.jsxs(e.Fragment,{children:[A.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-tide-text mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"text-primary",children:"★"})," My Projects"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:A.map(t=>{const l=i.some(r=>r.container_id===t.id&&r.status==="pending");return e.jsx(I,{container:t,hasUpdate:l,vulnforgeGlobalEnabled:F,onClick:()=>z(t)},t.id)})})]}),R.length>0&&e.jsxs("div",{children:[A.length>0&&e.jsx("h2",{className:"text-xl font-bold text-tide-text mb-4",children:"Community Containers"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:R.map(t=>{const l=i.some(r=>r.container_id===t.id&&r.status==="pending");return e.jsx(I,{container:t,hasUpdate:l,vulnforgeGlobalEnabled:F,onClick:()=>z(t)},t.id)})})]})]})]}),J&&e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-cyan-400 border-t-transparent rounded-full"})}),children:e.jsx(me,{container:J,onClose:()=>z(null),onUpdate:o})})]})}export{Ne as default};
