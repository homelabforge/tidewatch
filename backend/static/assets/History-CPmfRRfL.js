import{a as n,j as e}from"./index-CGBKEoxX.js";import{r as d}from"./router-vendor-B592UMyg.js";import{S as h}from"./StatusBadge-Cc0T94DK.js";import{t as i,R as o,a as u,i as f,r as j}from"./ui-vendor-C8hJcGlO.js";import{f as x}from"./utils-vendor-DnsfCnls.js";import"./react-vendor-OvXVS5lI.js";function k(){const[s,m]=d.useState([]),[a,c]=d.useState(!0);d.useEffect(()=>{r()},[]);const r=async()=>{c(!0);try{const t=await n.history.getAll();m(t)}catch{i.error("Failed to load history")}finally{c(!1)}},p=async t=>{if(confirm("Are you sure you want to rollback this update? This will restore the previous version."))try{await n.history.rollback(t),i.success("Rollback initiated successfully"),r()}catch{i.error("Failed to rollback update")}};return e.jsx("div",{className:"min-h-screen bg-tide-bg",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-tide-text",children:"Update History"}),e.jsx("p",{className:"text-tide-text-muted mt-2",children:"View past container updates and rollbacks"})]}),e.jsxs("button",{onClick:r,disabled:a,className:"px-4 py-2 bg-primary hover:bg-primary-dark text-tide-text rounded-lg font-medium transition-colors disabled:opacity-50 flex items-center gap-2",children:[e.jsx(o,{size:16,className:a?"animate-spin":""}),"Refresh"]})]}),a?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(o,{className:"animate-spin mx-auto mb-4 text-primary",size:48}),e.jsx("p",{className:"text-tide-text-muted",children:"Loading history..."})]}):s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(u,{className:"mx-auto mb-4 text-gray-600",size:48}),e.jsx("p",{className:"text-tide-text-muted",children:"No update history found"}),e.jsx("p",{className:"text-sm text-tide-text-muted mt-2",children:"Updates will appear here once they are applied"})]}):e.jsxs("div",{className:"bg-tide-surface border border-tide-border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-tide-surface border-b border-tide-border",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-tide-text-muted uppercase tracking-wider",children:"Container"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-tide-text-muted uppercase tracking-wider",children:"Update"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-tide-text-muted uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-tide-text-muted uppercase tracking-wider",children:"Started"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-tide-text-muted uppercase tracking-wider",children:"Duration"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-tide-text-muted uppercase tracking-wider",children:"Performed By"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-tide-text-muted uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-tide-border",children:s.map(t=>{const l=t.completed_at?Math.round((new Date(t.completed_at).getTime()-new Date(t.started_at).getTime())/1e3):null;return e.jsxs("tr",{className:"hover:bg-tide-surface-light transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-tide-text",children:t.container_name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-tide-text",children:[e.jsx("span",{className:"font-mono",children:t.from_tag}),e.jsx(f,{size:14,className:"text-tide-text-muted"}),e.jsx("span",{className:"font-mono text-primary",children:t.to_tag})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(h,{status:t.status})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-tide-text",children:x(new Date(t.started_at),"MMM d, yyyy")}),e.jsx("div",{className:"text-xs text-tide-text-muted",children:x(new Date(t.started_at),"HH:mm:ss")})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-tide-text",children:l!==null?`${l}s`:"In progress"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-tide-text",children:t.performed_by||"System"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.rollback_available&&e.jsxs("button",{onClick:()=>p(t.id),className:"flex items-center gap-1 px-3 py-1.5 bg-tide-surface hover:bg-tide-surface-light text-tide-text rounded text-xs font-medium transition-colors",children:[e.jsx(j,{size:12}),"Rollback"]})})]},t.id)})})]})}),s.some(t=>t.error_message)&&e.jsxs("div",{className:"border-t border-tide-border p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-tide-text mb-3",children:"Recent Errors"}),e.jsx("div",{className:"space-y-2",children:s.filter(t=>t.error_message).slice(0,5).map(t=>e.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded-md p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-tide-text",children:t.container_name}),e.jsx("span",{className:"text-xs text-tide-text-muted",children:x(new Date(t.started_at),"MMM d, HH:mm")})]}),e.jsx("p",{className:"text-xs text-red-400",children:t.error_message})]},t.id))})]})]})]})})}export{k as default};
