# TideWatch Custom Sanitizer Model Extension
# This teaches CodeQL to recognize TideWatch's custom security functions as proper sanitizers
#
# Reference: https://codeql.github.com/docs/codeql-cli/using-a-codeql-pack-to-extend-an-analysis/

extensions:
  # Mark sanitize_log_message as a sanitizer for log injection
  # This function removes newlines and control characters from log messages
  - addsTo:
      pack: codeql/python-all
      extensible: summaryModel
    data:
      - ["app.utils.security", "Member[sanitize_log_message]", "Argument[0]", "ReturnValue", "taint", "manual"]

  # Mark sanitize_path as a sanitizer for path injection
  # This function validates paths against traversal attacks
  - addsTo:
      pack: codeql/python-all
      extensible: summaryModel
    data:
      - ["app.utils.security", "Member[sanitize_path]", "Argument[0]", "ReturnValue", "taint", "manual"]

  # Mark is_safe_filename as a path sanitizer
  # Returns boolean, so we mark it as a guard
  - addsTo:
      pack: codeql/python-all
      extensible: sinkModel
    data:
      - ["app.utils.security", "Member[is_safe_filename]", "Argument[0]", "path-injection", "manual"]

  # Mark validate_container_name as sanitizing its input
  - addsTo:
      pack: codeql/python-all
      extensible: summaryModel
    data:
      - ["app.utils.security", "Member[validate_container_name]", "Argument[0]", "ReturnValue", "taint", "manual"]

  # Mark validate_image_name as sanitizing its input
  - addsTo:
      pack: codeql/python-all
      extensible: summaryModel
    data:
      - ["app.utils.security", "Member[validate_image_name]", "Argument[0]", "ReturnValue", "taint", "manual"]
