name: "TideWatch CodeQL Config"

# This configuration file customizes CodeQL analysis for TideWatch
# It uses a model extension to teach CodeQL about our custom sanitizers

# Path filters to exclude test files from analysis
paths-ignore:
  - "**/tests/**"
  - "**/__tests__/**"
  - "**/test_*.py"
  - "**/*.test.ts"
  - "**/*.test.tsx"
  - "**/*.spec.ts"

# Model extensions to teach CodeQL about custom sanitizers
# This allows CodeQL to recognize sanitize_log_message(), sanitize_path(), etc.
# as proper security controls, so it can still detect NEW vulnerabilities
# while not flagging code that properly uses our sanitizers
packs:
  - codeql/python-queries

# Data extensions directory containing our custom sanitizer models
data-extensions:
  - extensions/tidewatch-sanitizers.yml

# Query filters for remaining false positives that can't be modeled
query-filters:
  # Exclude stack trace exposure - false positives flagging legitimate API responses:
  # - Validation error messages intended for users (e.g., "Invalid time format")
  # - Docker stats/metrics data
  # - Safe result dicts with hardcoded success messages
  # Actual exception handling uses safe_error_response() which logs details
  # server-side and returns only generic messages to clients
  - exclude:
      id: py/stack-trace-exposure

  # Exclude mixed returns - safe_error_response() is typed as NoReturn
  # but CodeQL's analysis doesn't fully track this through all code paths
  - exclude:
      id: py/mixed-returns
